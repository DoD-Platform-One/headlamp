# -- Istio configuration; see bb-common istio docs for details: https://repo1.dso.mil/big-bang/product/packages/bb-common/-/tree/main/docs/istio?ref_type=heads
# @default -- Istio disabled
istio:
  enabled: false

# -- Network Policy configuration; see bb-common network policy docs for details: https://repo1.dso.mil/big-bang/product/packages/bb-common/-/tree/main/docs/network-policies?ref_type=heads
# @default -- Basic configuration necessary for headlamp to function standalone.
networkPolicies:
  enabled: false
  egress:
    definitions:
      sso:
        to: []
    from:
      headlamp:
        to:
          definition:
            kubeAPI: true
            sso: false

# -- Routes configuration; see bb-common routes docs for details: https://repo1.dso.mil/big-bang/product/packages/bb-common/-/tree/main/docs/routes?ref_type=heads
# @default -- Routes disabled, Big Bang umbrella chart configures these when deployed with Istio
routes:
  inbound:
    headlamp:
      enabled: false
      gateways: []
      hosts: []
      service: headlamp-headlamp
      port: 4466
  # -- Outbound routes for external service access (e.g., SSO/Keycloak)
  # Big Bang umbrella chart configures these when SSO is enabled
  outbound:
    sso:
      enabled: false
      hosts: []

# -- Domain used for BigBang created exposed services
domain: dev.bigbang.mil

global:
  imagePullSecrets:
    - name: private-registry


# Toggles networkpolicy needed for openshift
openshift: false

# -- Monitoring toggle, affects servicemonitor and networkPolicies
monitoring:
  enabled: false
  serviceMonitor:
    scheme: ""
    tlsConfig: {}

# Values for bigbang helm tests
bbtests:
  enabled: false
  cypress:
    artifacts: true
    envs:
      cypress_url: "http://headlamp.headlamp.svc.cluster.local:4466"
    resources:
      requests:
        cpu: "1"
        memory: "2Gi"
      limits:
        cpu: "1"
        memory: "2Gi"

waitJob:
  enabled: true
  permissions:
    apiGroups:
      - apps
    resources:
      - deployments
    verbs:
      - get
      - list
      - watch

# -- BigBang RBAC configuration for Headlamp
# This section creates ClusterRoles and ClusterRoleBindings for controlling access.
# For SSO/Keycloak integration, bind to Groups that match Keycloak group names.
# See docs/keycloak.md and docs/RBAC.md for detailed configuration instructions.
# @default -- RBAC disabled, uses upstream chart's default cluster-admin binding
bigbang:
  rbac:
    # -- Enable BigBang RBAC management
    enabled: false

    # -- ClusterRoles to create
    # Each role defines a set of permissions that can be bound to users, groups, or service accounts
    clusterRoles:
      # Example: Read-only role for viewing cluster resources
      - name: headlamp-readonly
        create: true
        rules:
          - apiGroups: [""]
            resources:
              - namespaces
              - pods
              - pods/log
              - services
              - configmaps
              - events
              - nodes
              - persistentvolumeclaims
              - persistentvolumes
            verbs: ["get", "list", "watch"]
          - apiGroups: ["apps"]
            resources:
              - deployments
              - daemonsets
              - replicasets
              - statefulsets
            verbs: ["get", "list", "watch"]
          - apiGroups: ["batch"]
            resources:
              - jobs
              - cronjobs
            verbs: ["get", "list", "watch"]
          - apiGroups: ["networking.k8s.io"]
            resources:
              - ingresses
              - networkpolicies
            verbs: ["get", "list", "watch"]

    # -- ClusterRoleBindings to create
    # Binds ClusterRoles to subjects (Users, Groups, or ServiceAccounts)
    # For Keycloak SSO, use kind: Group with the Keycloak group name
    clusterRoleBindings:
      # Example: Bind to a ServiceAccount (for token-based access)
      - name: headlamp-sa-readonly
        roleRef: headlamp-readonly
        subjects:
          - kind: ServiceAccount
            name: dev-sa
            namespace: headlamp
      # Example: Bind to a Keycloak group (for SSO access)
      # Uncomment and modify for your Keycloak groups
      # - name: headlamp-keycloak-readonly
      #   roleRef: headlamp-readonly
      #   subjects:
      #     - kind: Group
      #       name: "headlamp-readers"  # Must match Keycloak group name exactly
      #       apiGroup: rbac.authorization.k8s.io
      # - name: headlamp-keycloak-admin
      #   roleRef: cluster-admin  # Use built-in cluster-admin for full access
      #   subjects:
      #     - kind: Group
      #       name: "headlamp-admins"
      #       apiGroup: rbac.authorization.k8s.io

upstream:
  image:
    registry: registry1.dso.mil
    repository: ironbank/opensource/headlamp-k8s/headlamp
    pullPolicy: Always
    tag: "v0.40.0"
    pullSecrets:
      - private-registry

  imagePullSecrets:
    - name: private-registry

  nameOverride: "headlamp"

  config:
    # base url path at which headlamp should run
    # Note: Do not include a trailing slash in the baseURL configuration.
    # Example: "/headlamp"
    baseURL: ""
    oidc:
      clientID: ""

  securityContext:
    capabilities:
      drop:
        - ALL

  service:
    port: 4466

  clusterRoleBinding:
    # -- Specified whether a cluster role binding should be created
    create: true
    # -- Set name of the Cluster Role with limited permissions from you cluster
    # for example - clusterRoleName: user-ro
    clusterRoleName: cluster-admin
    # -- Annotations to add to the cluster role binding
    annotations: {}
